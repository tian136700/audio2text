<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>随机密码生成</title>
    <meta name="renderer" content="webkit" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="/static/layui/css/layui.css" rel="stylesheet" />
    <style>
      #content {
        width: 95%;
        min-width: 800px;
        max-width: 1200px;
        margin: 40px auto 50px;
      }
      .layui-header {
        background: #16b777;
      }
      .section-title {
        font-size: 18px;
        margin: 15px 0;
        font-weight: bold;
      }
      .password-result {
        margin-top: 20px;
        padding: 20px;
        background: #f5f5f5;
        border-radius: 4px;
      }
      .password-item {
        margin-bottom: 15px;
        padding: 15px;
        background: #fff;
        border-radius: 4px;
        border: 1px solid #e6e6e6;
      }
      .password-text {
        font-size: 20px;
        font-family: 'Courier New', monospace;
        font-weight: bold;
        color: #333;
        word-break: break-all;
        margin-bottom: 10px;
        padding: 10px;
        background: #f9f9f9;
        border-radius: 4px;
      }
      .password-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 10px;
      }
      .strength-badge {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: bold;
      }
      .strength-very_strong {
        background: #5FB878;
        color: #fff;
      }
      .strength-strong {
        background: #1E9FFF;
        color: #fff;
      }
      .strength-medium {
        background: #FFB800;
        color: #fff;
      }
      .strength-weak {
        background: #FF5722;
        color: #fff;
      }
      .strength-very_weak {
        background: #999;
        color: #fff;
      }
      .layui-side {
        width: 200px;
        top: 60px;
        transition: margin-left 0.3s;
      }
      .layui-side.hide {
        margin-left: -200px;
      }
      .layui-body {
        top: 60px;
        padding: 15px;
        transition: left 0.3s;
      }
      .layui-body.sidebar-hidden {
        left: 0 !important;
      }
      .sidebar-toggle {
        position: fixed;
        left: 200px;
        top: 60px;
        z-index: 1000;
        background: #393D49;
        color: #fff;
        border: none;
        padding: 10px 5px;
        cursor: pointer;
        border-radius: 0 4px 4px 0;
        transition: left 0.3s;
      }
      .sidebar-toggle:hover {
        background: #2F3437;
      }
      .sidebar-toggle.sidebar-hidden {
        left: 0;
      }
      .copy-btn {
        margin-left: 10px;
      }
    </style>
  </head>
  <body>
    <div class="layui-layout layui-layout-admin">
      <div class="layui-header" style="background: #16b777;z-index:1">
        <div class="layui-logo layui-hide-xs" style="color: #fff">随机密码生成</div>
      </div>
      {% include 'includes/sidebar.html' %}
      <!-- 内容主体区域 -->
      <div class="layui-body">
        <div id="content">
          <h2>随机密码生成器</h2>
          <p>自定义密码规则，生成安全可靠的随机密码。</p>

          <!-- 配置表单 -->
          <div class="layui-card">
            <div class="layui-card-body">
              <form class="layui-form layui-form-pane">
                <div class="layui-form-item">
                  <label class="layui-form-label">密码长度</label>
                  <div class="layui-input-inline">
                    <input
                      type="number"
                      id="password-length"
                      value="16"
                      min="8"
                      max="128"
                      class="layui-input"
                    />
                  </div>
                  <div class="layui-form-mid layui-word-aux">8-128 字符</div>
                </div>

                <div class="layui-form-item">
                  <label class="layui-form-label">字符类型</label>
                  <div class="layui-input-block">
                    <input
                      type="checkbox"
                      name="include-uppercase"
                      title="大写字母 (A-Z)"
                      checked
                      lay-skin="primary"
                    />
                    <input
                      type="checkbox"
                      name="include-lowercase"
                      title="小写字母 (a-z)"
                      checked
                      lay-skin="primary"
                    />
                    <input
                      type="checkbox"
                      name="include-digits"
                      title="数字 (0-9)"
                      checked
                      lay-skin="primary"
                    />
                    <input
                      type="checkbox"
                      name="include-special"
                      title="特殊字符 (!@#$%...)"
                      checked
                      lay-skin="primary"
                    />
                  </div>
                </div>

                <div class="layui-form-item">
                  <label class="layui-form-label">排除选项</label>
                  <div class="layui-input-block">
                    <input
                      type="checkbox"
                      name="exclude-similar"
                      title="排除相似字符 (0, O, l, 1)"
                      checked
                      lay-skin="primary"
                    />
                    <input
                      type="checkbox"
                      name="exclude-ambiguous"
                      title="排除易混淆字符 (I, l, |)"
                      checked
                      lay-skin="primary"
                    />
                  </div>
                </div>

                <div class="layui-form-item">
                  <label class="layui-form-label">生成数量</label>
                  <div class="layui-input-inline">
                    <input
                      type="number"
                      id="password-count"
                      value="1"
                      min="1"
                      max="50"
                      class="layui-input"
                    />
                  </div>
                  <div class="layui-form-mid layui-word-aux">1-50 个</div>
                </div>

                <div class="layui-form-item">
                  <div class="layui-input-block">
                    <button
                      type="button"
                      class="layui-btn layui-btn-normal"
                      id="generate-btn"
                    >
                      <i class="layui-icon layui-icon-refresh"></i> 生成密码
                    </button>
                    <button
                      type="button"
                      class="layui-btn layui-btn-primary"
                      id="clear-btn"
                    >
                      清空结果
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>

          <!-- 密码结果显示 -->
          <div class="password-result layui-hide" id="password-result">
            <div class="section-title">生成的密码</div>
            <div id="password-list"></div>
          </div>
        </div>
      </div>
    </div>

    <script src="/static/layui/layui.js"></script>
    <script>
      let language = "zh"; // 强制使用中文
      window.$ = layui.$;
      
      // 强制显示中文
      $("[data-cn]").each(function () {
        var $this = $(this);
        var text = $this.attr("data-cn");
        // 如果是菜单项，填充到 .menu-text 中
        var $menuText = $this.find(".menu-text");
        if ($menuText.length) {
          $menuText.text(text);
        } else {
          // 其他元素，追加文字
          $this.html($this.html() + text);
        }
      });
      
      layui.use(["form", "layer"], function () {
        var form = layui.form;
        var layer = layui.layer;
        var $ = layui.$;

        // 侧边栏隐藏/显示功能
        var sidebarHidden = false;
        $("#sidebar-toggle").click(function() {
          sidebarHidden = !sidebarHidden;
          if (sidebarHidden) {
            $("#sidebar").addClass("hide");
            $(".layui-body").addClass("sidebar-hidden");
            $(this).addClass("sidebar-hidden");
            $(this).find("i").removeClass("layui-icon-shrink-right").addClass("layui-icon-spread-left");
          } else {
            $("#sidebar").removeClass("hide");
            $(".layui-body").removeClass("sidebar-hidden");
            $(this).removeClass("sidebar-hidden");
            $(this).find("i").removeClass("layui-icon-spread-left").addClass("layui-icon-shrink-right");
          }
        });

        // 生成密码
        $("#generate-btn").click(function () {
          var length = parseInt($("#password-length").val()) || 16;
          var count = parseInt($("#password-count").val()) || 1;
          
          // 获取复选框状态
          var includeUppercase = $('input[name="include-uppercase"]').is(':checked');
          var includeLowercase = $('input[name="include-lowercase"]').is(':checked');
          var includeDigits = $('input[name="include-digits"]').is(':checked');
          var includeSpecial = $('input[name="include-special"]').is(':checked');
          var excludeSimilar = $('input[name="exclude-similar"]').is(':checked');
          var excludeAmbiguous = $('input[name="exclude-ambiguous"]').is(':checked');
          
          // 验证至少选择一种字符类型
          if (!includeUppercase && !includeLowercase && !includeDigits && !includeSpecial) {
            layer.alert("请至少选择一种字符类型！", { title: false });
            return;
          }
          
          // 验证长度
          if (length < 8 || length > 128) {
            layer.alert("密码长度必须在 8-128 之间！", { title: false });
            return;
          }
          
          // 验证数量
          if (count < 1 || count > 50) {
            layer.alert("生成数量必须在 1-50 之间！", { title: false });
            return;
          }
          
          // 发送请求
          $.post(
            "/generate_password",
            {
              length: length,
              count: count,
              include_uppercase: includeUppercase ? "true" : "false",
              include_lowercase: includeLowercase ? "true" : "false",
              include_digits: includeDigits ? "true" : "false",
              include_special: includeSpecial ? "true" : "false",
              exclude_similar: excludeSimilar ? "true" : "false",
              exclude_ambiguous: excludeAmbiguous ? "true" : "false"
            },
            function (res) {
              if (res.code !== 0) {
                layer.alert("生成失败：" + res.msg, { title: false });
                return;
              }
              
              // 显示结果
              displayPasswords(res.data);
            }
          ).fail(function () {
            layer.alert("请求失败，请检查网络或后端服务", { title: false });
          });
        });
        
        // 显示密码
        function displayPasswords(passwords) {
          var html = "";
          passwords.forEach(function (item, index) {
            var strengthClass = "strength-" + item.strength;
            html += `
              <div class="password-item">
                <div class="password-text" id="password-${index}">${item.password}</div>
                <div class="password-info">
                  <div>
                    <span>长度: ${item.length}</span>
                    <span style="margin-left: 15px;">强度: <span class="strength-badge ${strengthClass}">${item.strength_text}</span></span>
                  </div>
                  <div>
                    <button type="button" class="layui-btn layui-btn-sm copy-btn" onclick="copyPassword(${index})">
                      <i class="layui-icon layui-icon-copy"></i> 复制
                    </button>
                  </div>
                </div>
              </div>
            `;
          });
          
          $("#password-list").html(html);
          $("#password-result").removeClass("layui-hide");
          
          // 滚动到结果区域
          $('html, body').animate({
            scrollTop: $("#password-result").offset().top - 100
          }, 300);
        }
        
        // 复制密码函数（全局）
        window.copyPassword = function(index) {
          var passwordText = $("#password-" + index).text();
          // 创建临时文本区域
          var tempInput = $("<input>");
          $("body").append(tempInput);
          tempInput.val(passwordText).select();
          document.execCommand("copy");
          tempInput.remove();
          layer.msg("密码已复制到剪贴板", { icon: 1, time: 1000 });
        };
        
        // 清空结果
        $("#clear-btn").click(function () {
          $("#password-list").html("");
          $("#password-result").addClass("layui-hide");
        });
      });
    </script>
  </body>
</html>

